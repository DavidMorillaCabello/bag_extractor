<launch>
  <arg name="bagname"/>
  <arg name="folder" default="raw_bag/"/>
  <arg name="rgb_compressed_topic" default="/axis_rgb/camera/image_raw"/>
  <arg name="rgb_folder" default="image00/"/>
  <arg name="the_compressed_topic" default="/axis_the/camera/image_raw"/>
  <arg name="the_folder" default="image01/"/>
  <arg name="velodyne_topic" default="/velodyne_points"/>
  <arg name="velodyne_folder" default="velodyne_points/"/>

  <node name="create_directories" type="createDirectories.sh" pkg="bag_extractor">
  <node name="image_transport_rgb" type="republish" pkg="image_transport" args="compressed in:=$(arg rgb_compressed_topic) raw out:=camera_rgb/image"/>
  <node name="extract_rgb" pkg="image_view" type="extract_images" respawn="false" required="true" output="screen">
  <remap from="image" to="camera_rgb/image"/>
  <param name="filename_format" value="$(arg folder)$(arg rgb_folder)data/%010i.png"/>
  </node>
  <node name="im_tmstp_rgb" type="img_tmstp2txt" pkg="bag_extractor" output="screen" args="_topic:=$(arg rgb_compressed_topic)/compressed _folder:=$(arg folder)$(arg rgb_folder)"/>
  
  <node name="image_transport_the" type="republish" pkg="image_transport" args="compressed in:=$(arg the_compressed_topic) raw out:=camera_the/image"/>
  <node name="extract_the" pkg="image_view" type="extract_images" respawn="false" required="true" output="screen">
  <remap from="image" to="camera_the/image"/>
  <param name="filename_format" value="$(arg folder)$(arg the_folder)data/%010i.png"/>
  </node>
  <node name="im_tmstp_the" type="img_tmstp2txt" pkg="bag_extractor" output="screen" args="_topic:=$(arg the_compressed_topic)/compressed _folder:=$(arg folder)$(arg the_folder)"/>

  <node name="pcl_convert" type="pcl_convert" pkg="bag_extractor" output="screen" args="_folder:=$(arg folder)$(arg velodyne_folder) _velodyne_topic:=$(arg velodyne_topic)"/>
  <node name="pc_tmstp" type="pc_tmstp2txt" pkg="bag_extractor" output="screen" args="_topic:=$(arg velodyne_topic) _folder:=$(arg folder)$(arg velodyne_folder)"/>

  <node name="rosbag" type="play" pkg="rosbag" required="true" output="screen" args="$(arg bagname) -r 0.075"/>

</launch>
